<a name="---"></a><!---
---
デモ: タイトル: 'Azure ネットワーク セキュリティ グループ (NSG)' ラーニング パス/モジュール/ユニット: 'ラーニング パス: Microsoft セキュリティ ソリューションの機能について説明する; モジュール 1: Azure の基本的なセキュリティ機能を説明する; ユニット 6: Azure ネットワーク セキュリティ グループについて説明する'
---
--->

# <a name="demo-azure-network-security-groups-nsgs"></a>デモ:Azure ネットワーク セキュリティ グループ (NSG)

このデモは、次の Learn コンテンツに対応しています。

- ラーニング パス: Microsoft セキュリティ ソリューションの機能について説明する
- モジュール: Azure の基本的なセキュリティ機能を説明する
- ユニット: Azure ネットワーク セキュリティ グループについて説明する

## <a name="demo-scenario"></a>デモ シナリオ

このデモでは、Azure ネットワーク セキュリティ グループ (NSG) の機能について説明します。  これを行うには、デモ前のセットアップの一環として、最初に NSG なしで仮想マシン (VM) を作成します。 また、インターフェイスやサブネットが関連付けられていない NSG を作成します。  デモの一部として、NSG のデフォルトの受信規則と送信規則について説明します。 次に、VM のインターフェイスを NSG に割り当てるプロセスを実行します。  構成した後、既定の NSG 規則や作成した規則を使用して、VM への接続をテストします。
  
### <a name="pre-demo-setup-part-1"></a>デモ前のセットアップ パート 1

 講師は、VM の作成に数分かかる可能性があるため、クラス時間の**前**にこれを行うことをお勧めします。 このセットアップでは、Windows 10 仮想マシンを作成します。

1. ブラウザーで、**[ホーム – Microsoft Azure]** タブを開きます。  タブを以前に閉じた場合は、ブラウザー ページを開き、アドレス バーに「portal.azure.com」と入力して、再度サインインします。

1. 検索ボックスのページ上部にある Microsoft Azure と表示されている場所の隣の青色のバーに、「**仮想マシン**」と入力し、検索結果で **[仮想マシン]** を選択します。  

1. ページの左上で、**[+ 追加]** を選択してから、**[+ 仮想マシン]** を選択します。

1. [基本] タブで、次の情報を入力します (一覧表示されていない場合は、既定の設定のままにします)。
    1. **サブスクリプション**: Azure Pass - スポンサーシップが既定の設定であることを確認します。
    1. **リソース グループ**: **[新規作成]** を選択してから、[名前] フィールドに「**LabsSC900-RG**」と入力し、**[OK]** を選択します。
    1. **仮想マシン名**: 「**SC900-WinVM**」と入力します。
    1. **リージョン**: 既定値のままにします。
    1. **可用性オプション**: 必ず **[インフラストラクチャ冗長は必要ありません]** を選択します。  注: 可用性オプションを [インフラストラクチャ冗長は必要ありません] に設定することが非常に重要です。設定しないと、デモが意図したとおりに機能しません。  可用性オプションを使用するには NSG が必要であり、意図的に NSG なしで VM を作成しています。
    1. **イメージ**: ドロップダウンから、 **[Windows 10 Pro, Version 21H2 – Gen 2]** を選択します。
    1. **サイズ**: ドロップダウンから **[すべてのサイズを表示]** を選択し、 **[B2s]** を選択してから、ページの下部の **[選択]** をクリックします。
    1. **ユーザー名**:任意のユーザー名を入力します。  VM にアクセスするために必要なので、記録しておいてください。
    1. **パスワード**: 任意のパスワードを入力します。  VM にアクセスするために必要なので、記録しておいてください。
    1. **パブリック受信ポート**: 既定値のままにして、 **[選択したポートを許可]** します。
    1. **受信ポートの選択**: 既定の **[RDP 3389]** のままにします
    1. **ライセンス**: **[I confirm I have an eligible Windows 10 license with multi-tenant hosting rights]\(マルチテナントをホストする権利を持つ有効な Windows 10 ライセンスを所有しています\)** を選択し、ボックスにチェックマークが表示されるようにします。
    1. **ディスク** を選択します。

1. 現在、VM 構成の [ディスク] タブが表示されています。  すべての設定を既定のままにして、 **[次へ: ネットワーク >]** を選択します。
1. 現在、VM 構成の [ネットワーク] タブが表示されています。  [NIC ネットワーク セキュリティ グループ] オプションで **[なし]** を選択します。 その他の設定はすべて既定値のままにします。
1. ページの下部にある **[次へ: 確認と作成]** を選択し、検証に合格したら、 **[作成]** を選択します。 VM のデプロイが完了するまでに数分かかる場合があります。
1. VM のデプロイが完了したら、**[リソースに移動]** を選択します。
1. SC900-WinVM ページに移動します。
1. ページの上部で、**[接続]** を選択してから、ドロップダウンで、**[RDP]** を選択します。
1. ポートの前提条件が満たされていないことにご注意ください。  前提条件を満たすためには、RDP で使用される宛先ポート 3389 を使用する受信ネットワーク セキュリティ規則を構成する必要があります。  これは、次のタスクで、ネットワーク セキュリティ グループを作成するときに行います。
1. このブラウザー タブは開いたままにしておきます。


### <a name="pre-demo-setup-part-2"></a>デモ前のセットアップ パート 2

ネットワーク セキュリティ グループを作成しますが、VM のネットワーク インターフェイスをその NSG に割り当てないでください。  

1. ブラウザーで、[SC900-WinVM – Microsoft Azure] タブを開きます。

1. 検索ボックスのページ上部にある Microsoft Azure と表示されている場所の隣の青色のバーに、「**ネットワーク セキュリティ グループ**」と入力し、検索結果で、**[ネットワーク セキュリティ グループ]** を選択します。  ネットワーク セキュリティ グループ クラシックを選択しないでください。

1. [ネットワーク セキュリティ グループ] ページで、**[+ 作成]** を選択します。

1. [ネットワーク セキュリティ グループの作成] ページの [基本] タブで、次の設定を指定します。
    1. [サブスクリプション]:Azure Pass – スポンサーシップ
    1. リソース グループ: **LabsSC900-RG**
    1. 名前: **NSG-SC900**
    1. リージョン: 既定値のままにします。
    1. **[確認および作成]** を選択し、**[作成]** を選択します。

1. デプロイが完了したら、**[リソースに移動]** を選択し、すべてが正しいことを確認します。  3 つの既定の受信規則、3 つの既定の送信規則があり、NSG に関連付けられたサブネットとインターフェイスはありません。  Azure portal の **[ホーム]** ページに戻ります。  

### <a name="demo"></a>デモ

NSG の設定について詳しく説明します。  この場合、VM インターフェイスにまだ割り当てられていない既存の NSG (上記のセットアップで作成したもの) について詳しく説明します。 次に、インターフェイスを NSG に関連付けるプロセスと、受信規則と送信規則を作成するプロセスについて説明します。

1. ブラウザー タブ **[ホーム - Microsoft Azure]** を開きます。  タブを以前に閉じた場合は、ブラウザー ページを開き、アドレス バーに「portal.azure.com」と入力して、再度サインインします。

1. 検索ボックスのページ上部にある Microsoft Azure と表示されている場所の隣の青色のバーに、「**ネットワーク セキュリティ グループ**」と入力し、検索結果で、**[ネットワーク セキュリティ グループ]** を選択します。  ネットワーク セキュリティ グループ クラシックを選択しないでください。

1. [NSG] ページで、セットアップで作成した NSG (**NSG-SC900**) を選択します。

1. 左ナビゲーション パネルの **[概要]** タブが強調表示されます。  NSG の既定の受信および送信規則に注意してください。 NSG が作成され、トラフィックをフィルター処理するための既定の規則がありますが、NSG に関連付けられているインターフェイスはありません。 これは、ページの右上にある "関連付けられている:0 サブネット、0 ネットワーク インターフェース" で確認できます。  NSG がそのことを行うには、何かに割り当てる必要があります。  この場合、以前に作成された VM のネットワーク インターフェイスに割り当てます。

1. NSG-SC900 のページの左ナビゲーション ペインの [設定] で、**[ネットワーク インターフェイス]** を選択します。

1. 検索ボックスの上にある **[+ 関連付け]** を選択し、ドロップダウンで **sc900-winvmXXX** (XXX は VM のネットワーク インターフェイスに固有) を選択して、**[OK]** を選択します。 インターフェイスが関連付けられると、画面の右上隅に通知ボックスが表示されます。 インターフェイスが NSG に関連付けられると、一覧に表示されます。

1. **[概要]** タブに戻ります。ページの右上に [関連付けられている: 0 サブネット、1 ネットワーク インターフェイス] と表示されていることに注意してください。これで、インターフェイスが NSG に割り当てられました。 また、学習者に既定の規則を強調します。 受信の場合、他の Azure 仮想ネットワークと Azure Load Balancer からのトラフィックのみが許可されます。 VM への他のすべての受信トラフィックは拒否されます。 また、既定の送信規則を呼び出します。  他の vne tへの送信ラフィックと送信インターネット トラフィックのみが許可されます。  デモの一環として、受信トラフィックが拒否されたことを示すために 1 分かかることをお勧めします。
    1. ページの上部にある検索バーに「**仮想マシン**」と入力して、選択します。
    1. [仮想マシン] ページで、**SC900-WinVM** を選択します。
    1. SC900-WinVM のページの上部で、**[接続]** を選択してから、**[RDP]** を選択します。
    1. ポートの前提条件が満たされていないことにご注意ください。  前提条件を満たすためには、RDP で使用される宛先ポート 3389 を使用する受信ネットワーク セキュリティ規則を構成する必要があります。  

1. 次に、受信 RDP トラフィックを許可する新しい規則を作成します。  既存の既定の規則を削除することはできません。作成できるのは、優先度の高い新しい規則のみです。 左ナビゲーション パネルで、[設定] の下の **[ネットワーク]** を選択します。  VM の [ネットワーク] ページを開いています。
1. **[受信ポート規則]** タブが選択されている (下線が付いている) ことを確認し **[受信ポート規則の追加]** を選択して、次の設定で、受信 RDP トラフィックを許可する規則を作成します。
    1. 出典: **[任意]**
    1. ソース ポート範囲: **\***
    1. 宛先: **Any**
    1. サービス:**RDP**
    1. アクション: **許可**
    1. 優先順位: **300**。注: 小さい数字の規則は高い優先順位を持ち、最初に処理されます。 したがって、この新しい規則の優先度は、すべての受信トラフィックを拒否する既存の規則の優先度よりも高くする必要があります。
    1. 名前: **AllowRDP**
    1. **[追加]** を選択します。
    1. 規則がプロビジョニングされると、受信規則の一覧に表示されます。

1. 次に、 **[送信ポートの規則]** タブを選択し、既定の規則を確認します。  ページの上部で **[送信ポートの規則の追加]** を選択し、さまざまな設定について説明します。  ルールを作成することをお勧めします – 以下の設定は、送信インターネット トラフィックを拒否する規則を作成します。
    1. 出典: **[任意]**
    1. ソース ポート範囲: **\***
    1. 宛先:"**サービス タグ**"
    1. 宛先サービス タグ:**Internet**
    1. サービス:**カスタム** (既定のままにします)
    1. 宛先ポート範囲: **\*** (宛先ポート範囲フィールドに必ずアスタリスクを入力してください)。
    1. プロトコル: **[任意]**
    1. アクション:**拒否**
    1. 優先順位: **4000** (注意すべき点は、インターネット送信トラフィックを許可する既存の規則の優先度よりも優先度を高くする必要があるということです。)
    1. 名前: **DenyInternet**
    1. **[追加]** を選択します。
    1. 規則がプロビジョニングされると、送信規則の一覧に表示されます。

1. 次に、VM に戻り、規則をテストします。  ページの上部で、 **[SC900-VM]** を選択します。

1. RDP を使用して、VM に接続できることを確認して、受信規則をテストします。
    1. 左ナビゲーション パネルで、**[接続]** を選択します。
    1. IP アドレスがパブリック IP アドレスに設定されていることを確認し、既定のポート番号のままにして、**[DRP ファイルのダウンロード]** を選択します。
    1. ダウンロードしたファイルを**開き**、**[接続]** を選択します。
    1. 資格情報の入力を求められます。 VM を作成するときに使用したユーザー名とパスワードを入力します。  資格情報の入力を求めるウィンドウで PIN が要求された場合は、**[その他]** を選択してから、**[別のアカウントを使う]** を選択します。
    1. リモート デスクトップ接続ウィンドウが開き、リモート コンピューターの ID を確認できないことを示します。 いずれにしても接続しますか?" というメッセージと共に開きます。 **[はい]** を選択します。
    1. これで、VM に接続されました。 作成した受信トラフィック規則が RDP を介した VM への受信トラフィックを許可しているため、この場合、VM に接続できたことを学習者に強調します。

1. 次に、送信 NSG 規則をテストします
    1. VM で Microsoft Edge ブラウザーを開きます。
    1. 「**www.bing.com**」と入力します。 ページは表示されません。 注: インターネットに接続でき、送信規則のすべてのパラメーターが適切に設定されていたことを確認した場合、これは規則が有効になるまで数分かかることによる可能性があります。 しばらく待ってから再試行してください。

1. IP アドレスが表示されるページの上中央の **[X]** を選択して、リモート デスクトップ接続を閉じます。 ポップアップ ウィンドウにリモート セッションが閉じられたことが表示されます。 **[OK]** を選択します。

1. ページ上部の青色バーで **[Microsoft Azure]** を選択して、Azure portal の [ホーム] ページに戻ります。

### <a name="post-course-delivery-tear-down"></a>コース配信後の破棄

VM は課金リソースであり、このデモで VM を実行するコストは最小限ですが、コースを終えたら、VM と関連するリソースを含むリソース グループを削除することをお勧めします。

1. ブラウザーで、[SC900-WinVM – Microsoft Azure] タブを開きます。

1. ページの左下隅で、**[すべてのサービス]** を選択します。

1. [すべてのサービス] の隣の [フィルター サービス] ボックスで、「**リソース グループ**」と入力し、結果から **[リソース グループ]** を選択します。

1. **LabsSC900-RG** を選択します。

1. LabsSC900-RG のページの中央上部で、**[リソース グループの削除]** を選択します。

1. 開いたウィンドウで、リソース グループ名「**LabsSC900-RG**」を入力して、リソース グループとそのすべてのリソースの削除を確認してから、ページの下部で **[削除]** を選択します。

1. すべてのリソースとリソース グループが削除されるまで数分かかる場合があります。

#### <a name="review"></a>確認

このデモでは、インターフェイスを NSG に関連付けるプロセスなど、NSG に関連付けられた情報と設定について説明し、既定の受信規則と送信規則について説明し、最後に新しい規則を作成する手順について説明しました。
