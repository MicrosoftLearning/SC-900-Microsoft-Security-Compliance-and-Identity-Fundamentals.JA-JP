---
lab:
  title: Azure ネットワーク セキュリティ グループ (NSG) の詳細を確認する
  module: 'Module 3 Lesson 1: Describe the capabilities of Microsoft security solutions: Describe basic security capabilities in Azure.'
ms.openlocfilehash: 47f71fdf1587a240803bb508a902ce098253793d
ms.sourcegitcommit: 07d6d5b9df44c747453e21a65bca524afbaf85ae
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/27/2022
ms.locfileid: "147695295"
---
# <a name="lab-explore-azure-network-security-groups-nsgs"></a>ラボ:Azure ネットワーク セキュリティ グループ (NSG) の詳細を確認する

## <a name="lab-scenario"></a>ラボのシナリオ

このラボでは、Azure のネットワーク セキュリティ グループの機能を詳細を確認します。  ネットワーク セキュリティ グループ (NSG) のない状態で VM を作成して、これを行います。 次に NSG の作成と VM のインターフェイスをその NSG に割り当てるプロセス実施します。  構成したら、既定のインバウンドおよびアウトバウンド規則を確認し、新しい規則を作成します。
  
**推定時間**:15 ～ 20 分

### <a name="task-1"></a>タスク 1

このタスクでは、Windows 10 仮想マシン を作成します。

1. Microsoft Edge を開きます。  アドレス バーに、「**portal.azure.com**」と入力します。

1. 管理者の資格情報でサインインします。
    1. [サインイン] ウィンドウで、「**admin@WWLxZZZZZZ.onmicrosoft.com**」と入力してから (ZZZZZZ はラボ ホスティング プロバイダーから支給されたご自分の一意のテナント ID です)、**[次へ]** を選択します。

    1. ラボ ホスティング プロバイダーから提供される管理者のパスワードを入力します。 **[サインイン]** をクリックします。
    1. サインインしたままにするかどうかを尋ねられたら、**[はい]** を選択します。
1. Microsoft Azure の隣の画面の左上隅で、[ポータル メニューを表示する] アイコン (3 本の水平方向のラインのあるアイコンで、ハンバーガー アイコンとも呼ばれます) を選択してから、**[すべてのサービス]** を選択します。  
1. メイン ウィンドウの [おすすめ] の下で、[仮想マシン] を選択します。  仮想マシンが一覧表示されない場合は、検索バーに仮想マシンと入力し、検索結果から選択します。
1. ページの左上で、 **[+ 作成]** を選択してから、 **[Azure Virtual Machine]** を選択します。
1. [基本] タブで、次の情報を入力します (一覧表示されていない場合は、既定の設定のままにします)。
    1. サブスクリプション: Azure Pass - スポンサーシップが既定の設定であることを確認します。

    1. リソース グループ: **[新規作成]** を選択してから、[名前] フィールドに「**LabsSC900**」と入力し、**[OK]** を選択します。
    1. 仮想マシン名: 「**SC900-WinVM**」と入力します。
    1. リージョン: リージョン フィールドが事前に設定されていない場合は、ご自分の場所に最も近いリージョンを選択します。
    1. イメージ: ドロップダウンから、 **[Windows 10 Pro, Version 21H2 – Gen 2]** を選択します。
    1. サイズ: ドロップダウンから **[すべてのサイズを表示]** を選択し、 **[B2s]** を選択してから、ページの下部の **[選択]** をクリックします。
    1. ユーザー名:任意のユーザー名を入力します。  VM にアクセスするために必要なので、記録しておいてください。
    1. パスワード: 任意のパスワードを入力します。  VM にアクセスするために必要なので、記録しておいてください。
    1. パブリック受信ポート: 既定値のままにして、 **[選択したポートを許可]** します。
    1. 受信ポートの選択: 既定の **[RDP 3389]** のままにします
    1. ライセンス: **[I confirm I have an eligible Windows 10 license with multi-tenant hosting rights]\(マルチテナントをホストする権利を持つ有効な Windows 10 ライセンスを所有しています\)** を選択し、ボックスにチェックマークが表示されるようにします。
    1. **ディスク** を選択します。
1. 現在、VM 構成の [ディスク] タブが表示されています。  すべての設定を既定のままにして、 **[次へ: ネットワーク >]** を選択します。
1. 現在、VM 構成の [ネットワーク] タブが表示されています。  [NIC ネットワーク セキュリティ グループ] オプションで **[なし]** を選択します。 その他の設定はすべて既定値のままにします。  注: この手順で none を選択する目的は、後続のタスクでネットワーク セキュリティ グループを最初から作成する手順を 1 つずつ説明することです。
1. ページの下部にある **[次へ: 確認と作成]** を選択し、検証に合格したら、 **[作成]** を選択します。 VM のデプロイが完了するまでに数分かかる場合があります。
1. VM のデプロイが完了したら、**[リソースに移動]** を選択します。
1. SC900-WinVM ページに移動します。
1. ページの上部で、**[接続]** を選択してから、ドロップダウンで、**[RDP]** を選択します。
1. ポートの前提条件が満たされていないことにご注意ください。  前提条件を満たすためには、RDP で使用される宛先ポート 3389 を使用する受信ネットワーク セキュリティ規則を構成する必要があります。  これは、次のタスクで、ネットワーク セキュリティ グループを作成するときに行います。
1. このブラウザー タブは開いたままにしておきます。

### <a name="task-2"></a>タスク 2

ネットワーク セキュリティ グループを作成し、その NSG に VM のネットワーク インターフェイスを割り当て、RDP トラフィック用の新しい受信規則を作成します。

1. ブラウザーで、[SC900-WinVM – Microsoft Azure] タブを開きます。

1. Microsoft Azure の隣のページの左上隅で、[ポータル メニューを表示する] アイコン (3 本の水平方向のラインのあるアイコンで、ハンバーガー アイコンとも呼ばれます) を選択してから、**[すべてのサービス]** を選択します。
1. [すべてのサービス] の隣の [フィルター サービス] ボックスで、「**ネットワーク セキュリティ グループ**」と入力し、結果から、**[ネットワーク セキュリティ グループ]** を選択します (ネットワーク セキュリティ グループ クラシックを選択しないでください)。
1. [ネットワーク セキュリティ グループ] ページで、**[+ 作成]** を選択します。
1. [ネットワーク セキュリティ グループの作成] ページの [基本] タブで、次の設定を指定します。
    1. [サブスクリプション]:Azure Pass – スポンサーシップ

    1. リソース グループ: **LabsSC900**
    1. 名前: **NSG-SC900**
    1. リージョン: 既定値のままにします。
    1. **[確認および作成]** を選択し、**[作成]** を選択します。
1. デプロイが完了したら、**[リソースに移動]** を選択します。
1. NSG の既定の受信および送信規則に注意してください。  NSG が作成され、トラフィックをフィルター処理するための既定の規則がありますが、NSG に関連付けられているインターフェイスはありません。
1. NSG-SC900 のページの左ナビゲーション ペインの [設定] で、**[ネットワーク インターフェイス]** を選択します。
1. [検索] ボックスの上で、**[+ 関連付け]** を選択します。
1. ページの右側には、NSG に関連付けるネットワーク インターフェイスを選択するためのフィールドがあります。 下向き矢印を選択し、 **[sc900-winvmXXX]** (XXX は、ご利用の VM のネットワーク インターフェイスに固有) を選択し、ウィンドウの下部にある **[OK]** を選択します。
1. インターフェイスが NSG に関連付けられると、一覧に表示されます。
1. 左側のナビゲーション ウィンドウで、 **[受信セキュリティ規則]** を選択します。
1. 既定の受信規則では、Vnet または Azure ロード バランサー以外のすべての受信トラフィックが拒否されるため、受信 RDP トラフィック (ポート 3389 上のトラフィック) を許可する規則を設定する必要があります。 既定の規則は削除できませんが、より優先度の高い規則を新しく作成してオーバーライドできることを思い出してください。
1. ページの最上部から **[追加]** を選びます。
1. [受信セキュリティ規則の追加] ウィンドウで、次の情報を指定します。
    1. 出典: **[任意]**

    1. ソース ポート範囲: **\***
    1. 宛先: **[任意]**
    1. サービス:**RDP**
    1. アクション:**許可**
    1. 優先順位: **300**。注: 小さい数字の規則は高い優先順位を持ち、最初に処理されます。
    1. 名前: **AllowRDP**
1. **[追加]** を選択します。
1. ルールがプロビジョニングされると、受信ルールの一覧に表示されます (画面を更新する必要がある場合があります)。
1. RDP を使用して、VM に接続できることを確認します。  最近のサービスを表示するには、ページの上部の Microsoft Azure の横にある検索フィールドを選択します。  **[仮想マシン]** を選択します。
1. VM の **[SC900-WinVM]** を選択します。
1. ページの上部で、**[接続]** を選択してから、ドロップダウンで、**[RDP]** を選択します。
1. IP アドレスがパブリック IP アドレスに設定されていることを確認し、既定のポート番号のままにして、**[DRP ファイルのダウンロード]** を選択します。
1. ダウンロードしたファイルを開き、**[接続]** を選択します。
1. 資格情報の入力を求められます。  VM を作成するときに使用したユーザー名とパスワードを入力します。
1. リモート デスクトップ接続ウィンドウが開き、リモート コンピューターの ID を確認できないことを示します。  いずれにしても接続しますか?" というメッセージと共に開きます。  **[はい]** を選択します。
1. これで、VM に接続されました。 VM に接続できた場合、これは作成した受信トラフィック規則が RDP を介する VM への受信トラフィックを許可していたためです。
1. 次のタスクで使用するため、VM を開いたままにしておきます。

### <a name="task-3"></a>タスク 3

NSG の既定の送信規則は、送信インターネット トラフィックを許可しているため、インターネットに接続できることを検証します。  次に、送信インターネット トラフィックをブロックするカスタム送信規則を作成するプロセスを行い、その規則をテストします。

1. VM から、**[Microsoft Edge]** を選択して、ブラウザーを開きます。  
1. ブラウザーのアドレス バーに「**www.bing.com**」と入力して、検索エンジンに接続できることを確認します。
1. VM のブラウザーを閉じます。しかし、後続の手順を使用するため、VM は開いたままにします。
1. Azure portal に戻り、ブラウザーで、[SC900-WinVM – Microsoft Azure] タブを開きます。
1. 左ナビゲーション パネルで、[設定] の下の **[ネットワーク]** を選択します。
1. **[送信ポートの規則]** タブを選択します。既定の送信規則が表示されます。  既定の規則は "AllowInternetOutBound" です。 この規則は、すべての送信インターネット トラフィックを許可します。 既定の規則を削除することはできませんが、優先度の高い新しい規則を作成することで規則をオーバーライドできます。 ページの右側で、**[送信ポートの規則を追加する]** を選択します。
1. [送信セキュリティ規則の追加] ページで、次の情報を入力します。
    1. 出典: **[任意]**

    1. ソース ポート範囲: **\***
    1. 宛先:"**サービス タグ**"
    1. 宛先サービス タグ:**Internet**
    1. サービス:**カスタム** (既定のままにします)
    1. 宛先ポート範囲: * (宛先ポート範囲フィールドに必ずアスタリスクを入力してください)
    1. プロトコル: **[任意]**
    1. アクション:**拒否**
    1. 優先順位: **4000**
    1. 名前: **DenyInternet**
1. **[追加]** を選択します。
1. 規則がプロビジョニングされると、送信規則の一覧に表示されます。  一覧に表示されますが、有効になるまで数分かかります (次の手順を続行する前に数分間待機します)。  
1. VM に戻ります
1. VM で Edge ブラウザーを開き、「**www.bing.com**」と入力します。 ページは表示されません。  注: インターネットに接続でき、送信規則のすべてのパラメーターが適切に設定されていたことを確認した場合、これは規則が有効になるまで数分かかることによる可能性があります。  ブラウザーを閉じ、しばらく待ってから再試行してください。
1. IP アドレスが表示されるページの上中央の **[X]** を選択して、リモート デスクトップ接続を閉じます。  ポップアップ ウィンドウにリモート セッションが閉じられたことが表示されます。 **[OK]** を選択します。
1. このタスクでは、NSG で送信規則を正常に構成し、送信インターネット トラフィックをブロックしました。

### <a name="tear-down"></a>破棄

VM は課金対象のリソースであり、このデモで VM を実行するコストは最小限ですが、コースの完了時に、VM と関連するリソースを含むリソース グループを削除することをお勧めします。

1. ブラウザーで、[SC900-WinVM – Microsoft Azure] タブを開きます。

1. ページの左下隅で、**[すべてのサービス]** を選択します。
1. [すべてのサービス] の隣の [フィルター サービス] ボックスで、「**リソース グループ**」と入力し、結果から **[リソース グループ]** を選択します。
1. **[LabsSC900]** を選択します。
1. [LabsSC900] ページの中央上で、**[リソース グループの削除]** を選択します。
1. 開いたウィンドウで、リソース グループ名「**LabsSC900**」を入力して、リソース グループとそのすべてのリソースの削除を確認してから、ページの下部で **[削除]** を選択します。
1. すべてのリソースとリソース グループが削除されるまで数分かかる場合があります。
1. 開いているブラウザー タブを閉じます。

### <a name="review"></a>確認

このラボでは、ネットワーク セキュリティ グループ (NSG) を設定し、その NSG を仮想マシンのネットワーク インターフェイスに関連付け、受信 RDP トラフィックを許可し、送信インターネット トラフィックをブロックする新しい規則を NSG に追加するプロセスについて説明しました。
