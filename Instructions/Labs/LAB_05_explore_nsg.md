<a name="---"></a><!---
---
ラボ: タイトル: 'Azure ネットワーク セキュリティ グループ (NSG) の詳細を確認する' ラーニング パス/モジュール/ユニット: 'ラーニング パス: Microsoft セキュリティ ソリューションの機能について説明する; モジュール 1: Azure の基本的なセキュリティ機能を説明する; ユニット 6: Azure ネットワーク セキュリティ グループについて説明する'
---
--->

# <a name="lab-explore-azure-network-security-groups-nsgs"></a>ラボ:Azure ネットワーク セキュリティ グループ (NSG) の詳細を確認する

このラボは、次の Learn コンテンツに対応しています。

- ラーニング パス: Microsoft セキュリティ ソリューションの機能について説明する
- モジュール: Azure の基本的なセキュリティ機能を説明する
- ユニット: Azure ネットワーク セキュリティ グループについて説明する

## <a name="lab-scenario"></a>ラボのシナリオ

このラボでは、Azure のネットワーク セキュリティ グループの機能について説明します。  これを行うには、ネットワーク セキュリティ グループ (NSG) を作成し、既存の仮想マシン (VM) のインターフェイスに NSG を割り当てます。  構成したら、既定のインバウンドおよびアウトバウンド規則を確認し、新しい規則を作成して、それらの規則をテストします。  このラボでは、NSG で使用する VM が自動的に作成されるため、まず、その VM に関連付けられている情報の一部を表示します。
  
**推定時間**:30 ～ 45 分

### <a name="task-1"></a>タスク 1

このタスクでは、このラボで使用するために作成された VM に関連付けられているパラメーターの一部を表示します。

1. Microsoft Edge を開きます。  アドレス バーに、「**portal.azure.com**」と入力します。

1. 管理者の資格情報でサインインします。
    1. [サインイン] ウィンドウで、ラボ ホスティング プロバイダーから提供されたユーザー名を入力して、 **[次へ]** を選択します。
    1. ラボ ホスティング プロバイダーから提供されている管理者パスワードを入力します。 **[サインイン]** をクリックします。
    1. サインインしたままにするかどうかを尋ねられたら、 **[はい]** を選択します。

1. ページの上部、Azure Services と表示されている場所の下で、 **[Virtual Machines]** を選択します。  リストに表示されない場合は、検索ボックスのページ上部にある [Microsoft Azure] と表示されている場所の隣の青色バーに、「**Virtual Machines**」と入力し、検索結果で **[Virtual Machines]** を選択します。

1. [Virtual Machines] ページで、 **[SC900-WinVM]** と表示されている VM を選択します。

1. SC900-WinVM ページに移動します。  VM が存在するリソース グループの名前 LabsSC900 をメモします。

1. ページの上部で、**[接続]** を選択してから、ドロップダウンで、**[RDP]** を選択します。 ポートの前提条件が満たされていないことにご注意ください。  前提条件を満たすためには、RDP で使用される宛先ポート 3389 を使用する受信ネットワーク セキュリティ規則を構成する必要があります。  これは、次のタスクで、ネットワーク セキュリティ グループを作成するときに行います。

1. 左ナビゲーション ウィンドウで、 **[ネットワーク]** を選択します。  
    1. 既定のビューは、受信ポート規則用です。  この VM のネットワーク インターフェイスには、ネットワーク セキュリティ グループが構成されていないことに注意してください。  送信ポート規則を選択した場合も同様です。
    1. [ネットワーク インターフェイス] と表示されている場所の横にある **[有効なセキュリティ規則]** を選択します。  "ネットワーク セキュリティ グループまたはアプリケーション セキュリティ グループがネットワーク インターフェイスに関連付けられていません" と表示されることを確認してください。
1. このブラウザー タブは開いたままにしておきます。

### <a name="task-2"></a>タスク 2

このタスクでは、ネットワーク セキュリティ グループを作成し、その NSG に VM のネットワーク インターフェイスを割り当て、RDP トラフィック用の新しいインバウンド規則を作成します。

1. ブラウザーで、[SC900-WinVM – Microsoft Azure] タブを開きます。

1. ページ上部の青い検索バーに、「**ネットワーク セキュリティ グループ**」と入力します。 結果から **[ネットワーク セキュリティ グループ]** を選択します ([ネットワーク セキュリティ グループ クラシック] は選択しないでください)。

1. [ネットワーク セキュリティ グループ] ページで、**[+ 作成]** を選択します。

1. [ネットワーク セキュリティ グループの作成] ページの [基本] タブで、次の設定を指定します。
    1. サブスクリプション: 既定値のままにします (これは、承認されたラボ ホストによって提供される Azure サブスクリプションです)
    1. リソース グループ: **LabsSC900**
    1. 名前: **NSG-SC900**
    1. リージョン: 既定値のままにします。
    1. **[確認および作成]** を選択し、**[作成]** を選択します。

1. デプロイが完了したら、**[リソースに移動]** を選択します。

1. [要点] と表示されているページの上部に、作成した NSG に関する基本情報がいくつか表示されます。  注意すべき 2 つの点は、カスタム セキュリティ規則がなく、この NSG に関連付けられているサブネットもネットワーク インターフェイスもない点です。  カスタム セキュリティ規則はありませんが、ページに示されているように、各 NSG に含まれる既定のインバウンドおよびアウトバウンド規則があります。  インバウンドおよびアウトバウンド規則を両方とも確認します。 既定のインバウンド規則は、仮想ネットワークまたは Azure ロード バランサーからの受信トラフィックをすべて拒否します。  アウトバウンド規則は、仮想ネットワーク間のトラフィックとインターネットへの送信トラフィックを除くすべての送信トラフィックを拒否します。

1. NSG-SC900 のページの左ナビゲーション ペインの [設定] で、**[ネットワーク インターフェイス]** を選択します。
    1. **[関連付け]** を選択します。
    2. ネットワーク インターフェイスの関連付けのフィールドで、**下向き矢印**を選択し、 **[sc900-winvmXXX]** を選択し、ウィンドウの下部にある **[OK]** を選択します。 インターフェイスが NSG に関連付けられると、一覧に表示されます。

1. 左側のナビゲーション ウィンドウで、 **[受信セキュリティ規則]** を選択します。

1. 既定のインバウンド規則では、仮想ネットワークまたは Azure ロード バランサー以外のすべての受信トラフィックが拒否されるため、受信 RDP トラフィック (ポート 3389 上のトラフィック) を許可する規則を設定する必要があります。 既定の規則は削除できませんが、より優先度の高い規則を新しく作成してオーバーライドできることを思い出してください。

1. ページの最上部から **[追加]** を選びます。 [受信セキュリティ規則の追加] ウィンドウで、次の情報を指定します。
    1. 出典: **[任意]**
    1. ソース ポート範囲: **\***
    1. 宛先: **[任意]**
    1. サービス:**RDP**
    1. アクション:**許可**
    1. 優先度: **1000**。 注: 小さい数字の規則は高い優先順位を持ち、最初に処理されます。
    1. 名前: 既定の名前のままにするか、独自のわかりやすい名前を作成します。
    1. ページの下部にある警告記号に注意してください。  RDP は、テスト目的でのみ、NSG の機能を示すために使用しています。
    1. **[追加]** を選択します。

1. ルールがプロビジョニングされると、受信ルールの一覧に表示されます (画面を更新する必要がある場合があります)。 新しく追加されたルールには、警告記号が表示されます。  前述のように、RDP はテスト目的でのみ、NSG の機能を示すために使用しています。 新しく追加した規則を選択します。

### <a name="task-3"></a>タスク 3

このタスクでは、新しく作成されたインバウンド NSG 規則をテストして、VM へのリモート デスクトップ (RDP) 接続を確立できることを確認します。  VM に接続したら、VM からインターネットへのアウトバウンド接続を確認します。

1. ブラウザーで、[SC900-WinVM – Microsoft Azure] タブを開きます。 以前にブラウザー タブを閉じた場合は、ページの上部にある青い検索バーを選択し、[Virtual Machines] を選択してから、VM **[SC900-WinVM]** を選択します。

1. ページの上部で、 **[接続]** を選択してから、 **[RDP]** を選択します。

1. IP アドレスがパブリック IP アドレスに設定されていることを確認し、既定のポート番号のままにして、**[DRP ファイルのダウンロード]** を選択します。

1. 表示されたポップアップ ウィンドウで、 **[ファイルを開く]** を選択します。

1. [リモート デスクトップ接続] ウィンドウが開いたら、 **[接続]** を選択します。

1. 資格情報の入力を求められます。  [ユーザー名] と [パスワード] を入力します (ラボの指示パネルの [リソース] タブを参照してください)。

1. リモート デスクトップ接続ウィンドウが開き、リモート コンピューターの ID を確認できないことを示します。  いずれにしても接続しますか?" というメッセージと共に開きます。  **[はい]** を選択します。

1. これで、VM に接続されました。 VM に接続できた場合、これは作成した受信トラフィック規則が RDP を介する VM への受信トラフィックを許可していたためです。

1. [ようこそ] 画面で、数秒後に、デバイスのプライバシー設定を選択するウィンドウが表示されたら、 **[同意する]** を選択します。  [ネットワーク] ウィンドウで、 **[いいえ]** を選択します。

1. VM が稼働している状態で、VM からインターネットへのアウトバウンド接続をテストします。
    1. VM から、 **[Microsoft Edge]** を選択して、ブラウザーを開きます。  Microsoft Edge を開くのは初めてなので、ポップアップ ウィンドウが表示される場合があります。 **[データなしで開始]** を選択してから、 **[このデータなしで続行]** を選択し、 **[確認して参照を開始]** を選択します。
    1. ブラウザーのアドレス バーに「**www.bing.com**」と入力して、検索エンジンに接続できることを確認します。
    1. www.bing.com にアクセスできることを確認したら、VM のブラウザー ウィンドウは閉じ、VM は起動したままにします。

1. VM の IP アドレスを示す青いタブでアンダースコア **_** を選択して、VM を最小化します。 これにより、SC900-WinVM の [接続] ページに戻ります。 

1. 左ナビゲーション ウィンドウで、 **[ネットワーク]** を選択します。

1. 次のタスクで使用するため、このブラウザー タブは開いたままにしておきます。

### <a name="task-4"></a>タスク 4

前のタスクでは、VM への RDP 接続を確立できることを確認しました。 VM に接続してから、インターネットへのアウトバウンド接続を確立できることも確認しました。  NSG の既定のアウトバウンド規則ではアウトバウンド インターネット トラフィックが許可されているため、アウトバウンド インターネット トラフィックが許可されました。  このタスクでは、インターネット トラフィックの送信をブロックするカスタム アウトバウンド規則を作成し、その規則をテストするプロセスを説明しました。

1. SC900-WinVM の [ネットワーク] ページが表示されるはずです。 以前にブラウザー タブを閉じた場合は、ページの上部にある青い検索バーを選択し、[Virtual Machines] を選択してから、VM **[SC900-WinVM]** を選択し、次に **[ネットワーク]** を選択します。

1. **[送信ポートの規則]** タブを選択します。既定のアウトバウンド規則が表示されます。  既定の規則は "AllowInternetOutBound" です。 この規則は、すべての送信インターネット トラフィックを許可します。 既定の規則を削除することはできませんが、優先度の高い新しい規則を作成することで規則をオーバーライドできます。 ページの右側で、**[送信ポートの規則を追加する]** を選択します。

1. [送信セキュリティ規則の追加] ページで、次の情報を入力します。
    1. 出典: **[任意]**
    1. ソース ポート範囲: **\***
    1. 宛先:"**サービス タグ**"
    1. 宛先サービス タグ:**Internet**
    1. サービス:**カスタム** (既定のままにします)
    1. 宛先ポート範囲: * (宛先ポート範囲フィールドに必ずアスタリスクを入力してください)
    1. プロトコル: **[任意]**
    1. アクション:**拒否**
    1. 優先度: **1000**
    1. 名前: 既定の名前のままにするか、独自のわかりやすい名前を作成します。
    1. **[追加]** を選択します。

1. 規則がプロビジョニングされると、送信規則の一覧に表示されます。  一覧に表示されますが、有効になるまで数分かかります (次の手順を続行する前に数分間待機します)。  

1. VM に戻ります (ページの下部にあるタスク バーに VM のアイコンが表示されます)。

1. VM で Microsoft Edge ブラウザーを開き、「**www.bing.com**」と入力します。 ページは表示されません。  注: インターネットに接続でき、アウトバウンド規則のすべてのパラメーターが適切に設定されていたことを確認した場合、これは規則が有効になるまで数分かかることによる可能性があります。  ブラウザーを閉じ、しばらく待ってから再試行してください。  注: ラボ環境の Azure サブスクリプションでは、通常よりも長い遅延が発生する場合があります。

1. IP アドレスが表示されるページの上中央の **[X]** を選択して、リモート デスクトップ接続を閉じます。  ポップアップ ウィンドウにリモート セッションが閉じることが示されます。 **[OK]** を選択します。

1. 開いているブラウザー タブを閉じます。

### <a name="review"></a>確認

このラボでは、ネットワーク セキュリティ グループ (NSG) を設定し、その NSG を仮想マシンのネットワーク インターフェイスに関連付け、受信 RDP トラフィックを許可し、送信インターネット トラフィックをブロックする新しい規則を NSG に追加するプロセスについて説明しました。
