<!---
---
ラボ: ラーニング パス: 'Microsoft Entra の機能について説明する' モジュール: 'Microsoft Entra ID のアクセス管理機能について説明する' ユニット: '条件付きアクセスについて説明する'
---
--->

# ラボ: Microsoft Entra 条件付きアクセス

このラボは、次の Learn コンテンツに対応しています。

- ラーニング パス: Microsoft Entra の機能について説明する
- モジュール: Microsoft Entra ID のアクセス管理機能について説明する
- ユニット: 条件付きアクセスについて説明する

## ラボのシナリオ

このラボでは、管理者およびユーザーの視点から、条件付きアクセス MFA の詳細を確認します。  管理者として、ユーザーがクラウドベースの Microsoft Azure Management アプリケーションにアクセスするとき、多要素認証の実施を要求するポリシーを作成します。  ユーザーの視点から、MFA に登録するためのプロセスを含む、条件付きアクセス ポリシーの影響を確認します。

**推定時間**:30 分

### タスク 1

このタスクでは、管理者として、ユーザー "Debra Berger" のパスワードをリセットします。  この手順は、後続のタスクで、ユーザーとして最初にサインインできるために必要です。

1. Microsoft Edge を開きます。  アドレス バーに「 **https://entra.microsoft.com** 」と入力し、管理者の資格情報でサインインします。
    1. [サインイン] ウィンドウで、「 **admin@WWLxZZZZZZ.onmicrosoft.com** 」と入力してから (ZZZZZZ はラボ ホスティング プロバイダーから提供された固有のテナント ID)、 **[次へ]** を選択します。
    1. ラボ ホスティング プロバイダーから提供されている管理者パスワードを入力します。 **[サインイン]** をクリックします。
    1. サインインしたままにするかどうかを尋ねられたら、**[はい]** を選択します。

1. 左側のナビゲーション ウィンドウで **[ID]** 、 **[ユーザー]** の順に展開し、 **[すべてのユーザー]** を選びます。

1. ユーザーの一覧から、**[Debra Berger]** を選択します。

1. ページの上部から、**[パスワードのリセット]** を選択します。 Debra Berger として以前にサインインしたことがなく、そのパスワードがわからないため、パスワードをリセットする必要があります。

1. [パスワードのリセット] ウィンドウが表示されたら、**[パスワードのリセット]** を選択します。  重要: 後のタスクで、ユーザーとしてサインインできるように、新しいパスワードを控えておいてください。

1. ページの右上隅にある **[X]** を選んでパスワード リセット ウィンドウを閉じてから、ページの右上隅にある **[X]** を選んで Debra Berger のウィンドウを閉じます。

1. 左ナビゲーション パネルで **[ホーム]** を選んで Microsoft Entra 管理センターに戻ります。

1. このウィンドウを開いたままにしておきます。

### タスク 2

このタスクでは、Azure AD で条件付きアクセス ポリシーを作成するプロセスを実行します。

1. ブラウザー タブで Microsoft Entra 管理センターのホーム ページを開きます。   ブラウザー タブを既に閉じている場合は、Microsoft Edge を開き、アドレス バーに「 **https://entra.microsoft.com** 」と入力して、ALH から提供された Microsoft 365 管理者の資格情報を使ってサインインします。

1. 左側のナビゲーション ウィンドウで、 **[保護]** を展開し、 **[条件付きアクセス]** を選びます。

1. [条件付きアクセスの概要] ページが表示されます。  ここでは、ポリシーの概要と一般的なアラートを示すタイルが表示されます。  左ナビゲーション パネルで **[ポリシー]** を選びます。

1. 左ナビゲーション パネルで **[ポリシー]** を選びます。 ここには、既存の条件付きアクセス ポリシーが一覧表示されます。 **[新しいポリシー]** を選択します。

1. "名前" フィールドに、「**MFA テスト ポリシー**」と入力します。

1. [ユーザー] で **[0 人のユーザーとグループが選択されました]** を選びます。

1. ユーザーまたはグループを含める、または除外するオプションが表示されます。  **[含める]** が選択されていることを確認します (下線)。

1. **[ユーザーとグループの選択]** のオプションを選択し、**[ユーザーとグループ]** を選択します。  ユーザーとグループを選択するためのウィンドウが表示されます。  

1. 検索バーに、「**Debra**」と入力します。  検索バーの下で **Debra Berger** を選択してから、ページの下部で **[選択]** ボタンを選択します。  通常はグループ内のユーザーにポリシーを割り当てることに注意してください。  このラボでの目的の便宜上、特定のユーザーにポリシーを割り当てます。

1. [ターゲット リソース] で **[ターゲット リソースが選択されていません]** を選びます。

1. **[このポリシーが適用される対象を選択する]** の下のフィールドで下矢印を選び、使用できるオプションを確認します。  既定の設定である **[クラウド アプリ]** のままにします。  **[含める]** タブに下線が付いていることを確認します。  **[アプリの選択]** を選び、 **[選択]** の下にある **[なし]** を選びます。  クラウド アプリを選択するためのウィンドウが表示されます。

1. 検索バーに「**Azure**」と入力します。  検索ボックスの下に表示される検索結果から **Microsoft Azure Management** を選択したら、ページの下部で **[選択]** を押します。  警告に注意してください。  

1. [条件] で、**[0 個の条件が選択されました]** を選択します。  異なるオプションを構成できることに注意してください。  ポリシーを通して、デバイスのユーザー リスク、サインイン リスク、デバイス プラットフォーム、場所、クライアント アプリ、フィルターなどの条件からの信号に基づいて、ユーザー アクセスを制御できます。  これらの構成できるオプションを確認してください。ただし、条件は設定しないでください。

1. 次に、アクセス制御を設定します。  [許可] で、**[0 個の制御が選択されました]** を選択します。

1. [許可] ウィンドウが開きます。  **[アクセスの付与]** が選ばれていることを確認してから、 **[多要素認証を要求する]** を選びます。 右側のウィンドウで下に少しスクロールし、[複数のコントロールの場合] セクションで、既定の **[選択したコントロールすべてが必要]** のままにします。  ページの下部の **[選択]** を押します。

1. ページの下部の [ポリシーの有効化] で、 **[オン]** を選んでから **[作成]** を選びます。

1. 左側のナビゲーション ウィンドウで、 **[ポリシー]** を選びます。 MFA Pilot ポリシーが、条件付きアクセス ポリシーの一覧に表示されるはずです (必要に応じて、ページの上部のコマンド バーにある **[更新] アイコン** を選びます)。

1. 画面右上隅のメール アドレスの隣のユーザー アイコンを選択し、**[サインアウト]** を選択してサインアウトします。次に、すべてのブラウザー ウィンドウを閉じます

### タスク 3

このタスクでは、ユーザー Debra Berger の視点から、条件付きアクセス ポリシーの影響を確認します。 最初に、条件付きアクセス ポリシーに含まれないアプリケーション (https://login.microsoftonline.com) の Microsoft 365 ポータル) にサインインします。  次に、条件付きアクセス ポリシーに含まれるアプリケーション (https://portal.azure.com) の Azure portal) でこのプロセスを繰り返します。  ユーザーが Microsoft Azure Management アプリケーションにアクセスするとき、MFA の実施を要求するポリシーを思い出してください。  MFA を使用するには、最初にモバイル デバイスまたは認証アプリケーションにコードを送信するなど、MFA に使用する認証方法を登録する必要があります。

1. Microsoft Edge を開きます。  アドレス バーに「 **https://login.microsoftonline.com** 」と入力します。
    1. **DebraB@WWLxZZZZZZ.onmicrosoft.com** としてサインインし (ZZZZZZ はラボ ホスティング プロバイダーから支給された固有のテナント ID)、 **[次へ]** を選択します。
    1. 前のタスクでメモしたパスワードを入力します。 **[サインイン]** をクリックします。
    1. 管理者がパスワードをリセットするときに提供されるパスワードは一時パスワードであるため、パスワードを更新する必要があります (これは、MFA ポリシーの一部ではありません)。 現在のパスワードを入力し、新しいパスワードを入力し、新しいパスワードを確認入力します。  タスクを完了するために必要になるので、新しいパスワードをメモしておきます。
    1. サインインしたままにするかどうかを尋ねられたら、**[はい]** を選択します。  Microsoft 365 アカウントへのログインに成功するはずです。 このアプリケーションの場合、MFA はポリシーの一部ではないため必要ありません。

1. 次に、MFA の条件を満たすアプリケーションへのサインインを試みます。 新しいブラウザー タブを開き、「 **https://portal.azure.com** 」を入力します。

1. その他の情報が必要であることを示すウィンドウが表示されます。  **[次へ]** を選択します。  これは条件付きアクセス ポリシーで識別されたクライアント アプリへの初めてのアクセスであるため、これにより MFA 登録プロセスが始まることに注意してください。  この登録プロセスは、1 回だけ行う必要があります。   ユーザーに登録プロセスを実施させるための代替方法は、管理者が使用する認証方法を構成する方法です。

1. [アカウントのセキュリティ保護] ウィンドウで、MFA で使用する方法を選択するオプションが与えられます。  Microsoft Authenticator は、1 つのオプションです。 このラボの演習では便宜上、異なる方法を選択します。  **[別の方法をセットアップする]** を選択します。  [別の方法を選択する] ポップアップ ウィンドウで、**ドロップダウンの矢印**を選択し、**[電話]** を選択したら、**[確定]** を選択します。

1. 表示されたウィンドウで、自分の国が選ばれていること確認した後、使う携帯電話番号を入力します。  **[コードを SMS 送信する]** が選択されていることを確認してから、 **[次へ]** を選びます。  コードの入力を求められたら入力する必要があるコードを含むテキスト メッセージが、携帯電話に表示されます。  受け取ったコードを入力して、 **[次へ]** を選びます。  確認すると、画面に "SMS が検証されました。 お使いの電話が正常に登録されました" と表示されます。  **[次へ]** を選択します。 その後、 **[完了]** を選択します。  これで、1 回限りの登録処理は完了です。

1. Azure portal にアクセスできるはずです。  Azure portal は Microsoft Azure Management アプリケーションであるので、作成した条件付きアクセス ポリシーに従い、Multi-Factor Authentication が必要となります。  
    1. サインインがタイムアウトしたというメッセージを受け取った場合は、パスワードを入力して、 **[サインイン]** を選びます。
    1. ID の確認を要求するウィンドウが表示されます。  "テキスト =X XXXXXXX" と表示されている場所を選択して携帯電話でコードを受け取り、コードを入力して **[確認]** を選択します。
    1. サインインしたままにするかどうかを尋ねられたら、 **[いいえ]** を選択します。

1. 画面右上隅のメール アドレスの隣のユーザー アイコンを選択し、[サインアウト] を選択してサインアウトします。次に、すべてのブラウザー ウィンドウを閉じます。

### 確認

このラボでは、ユーザーが Microsoft Azure Management クラウド アプリケーションにアクセスするときに MFA の実施を要求する、条件付きアクセス ポリシーをセットアップするプロセスを行いました。  次に、ユーザーとして MFA の登録プロセスを行い、Azure portal にアクセスするとき、MFA を使用することを要求する条件付きアクセス ポリシーの影響を確認しました。
